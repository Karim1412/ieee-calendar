<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IEEE EPI SB ‚Äì Event Management Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ===========================
       CSS VARIABLES & RESET
    =========================== */
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        --ieee-blue: #006699;
        --ieee-dark: #003366;
        --bg: #f4f6fb;
        --white: #ffffff;
        --text: #1a2033;
        --muted: #7a849a;
        --border: #e2e8f4;
        --shadow: 0 4px 24px rgba(0, 51, 102, 0.09);
        --shadow-lg: 0 16px 48px rgba(0, 51, 102, 0.16);
        --radius: 14px;
        --radius-sm: 8px;

        /* Chapter colors */
        --sb: #1a73e8;
        --ias: #1ea86e;
        --wie: #8b5cf6;
        --ras: #e8372a;
        --cis: #0fc3c3;
        --cs: #f97316;
      }

      body {
        font-family: "DM Sans", sans-serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
      }

      /* ===========================
       HEADER
    =========================== */
      header {
        background: linear-gradient(
          135deg,
          var(--ieee-dark) 0%,
          var(--ieee-blue) 100%
        );
        padding: 0 32px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 72px;
        box-shadow: 0 2px 20px rgba(0, 51, 102, 0.3);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .header-brand {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .header-logo {
        width: 42px;
        height: 42px;
        background: white;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Syne", sans-serif;
        font-weight: 800;
        font-size: 13px;
        color: var(--ieee-dark);
        letter-spacing: -0.5px;
        line-height: 1.1;
        text-align: center;
      }

      .header-title {
        font-family: "Syne", sans-serif;
        font-weight: 700;
        font-size: 1.15rem;
        color: white;
        letter-spacing: 0.2px;
      }

      .header-subtitle {
        font-size: 0.72rem;
        color: rgba(255, 255, 255, 0.65);
        font-weight: 300;
        letter-spacing: 0.5px;
        text-transform: uppercase;
      }

      .add-event-btn {
        background: white;
        color: var(--ieee-dark);
        border: none;
        border-radius: 40px;
        padding: 10px 22px;
        font-family: "Syne", sans-serif;
        font-weight: 700;
        font-size: 0.88rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s ease;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
      }

      .add-event-btn:hover {
        background: var(--ieee-dark);
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      }

      .add-event-btn svg {
        width: 16px;
        height: 16px;
      }

      /* ===========================
       MAIN LAYOUT
    =========================== */
      main {
        max-width: 1200px;
        margin: 0 auto;
        padding: 32px 20px 60px;
      }

      /* ===========================
       LEGEND
    =========================== */
      .legend {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 24px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 7px;
        background: var(--white);
        border: 1px solid var(--border);
        border-radius: 40px;
        padding: 5px 14px 5px 10px;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .legend-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        flex-shrink: 0;
      }

      /* ===========================
       CALENDAR CARD
    =========================== */
      .calendar-card {
        background: var(--white);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .calendar-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 28px;
        border-bottom: 1px solid var(--border);
        background: var(--white);
      }

      .calendar-nav-btn {
        width: 36px;
        height: 36px;
        border: 1px solid var(--border);
        background: var(--white);
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.18s;
        color: var(--text);
      }

      .calendar-nav-btn:hover {
        background: var(--ieee-blue);
        border-color: var(--ieee-blue);
        color: white;
      }

      .calendar-nav-btn svg {
        width: 16px;
        height: 16px;
      }

      .calendar-month-label {
        font-family: "Syne", sans-serif;
        font-weight: 700;
        font-size: 1.25rem;
        color: var(--text);
      }

      /* Day headers */
      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
      }

      .day-header {
        text-align: center;
        padding: 12px 4px 8px;
        font-size: 0.72rem;
        font-weight: 600;
        letter-spacing: 0.8px;
        text-transform: uppercase;
        color: var(--muted);
        border-bottom: 1px solid var(--border);
      }

      /* Calendar cells */
      .day-cell {
        min-height: 100px;
        padding: 8px 6px;
        border-right: 1px solid var(--border);
        border-bottom: 1px solid var(--border);
        vertical-align: top;
        position: relative;
        transition: background 0.15s;
      }

      .day-cell:nth-child(7n) {
        border-right: none;
      }
      .day-cell.other-month {
        background: #fafbfc;
      }
      .day-cell.other-month .day-num {
        color: #c5ccd8;
      }

      .day-cell.today .day-num {
        background: var(--ieee-blue);
        color: white;
        border-radius: 50%;
        width: 26px;
        height: 26px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .day-num {
        font-size: 0.82rem;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 4px;
        width: 26px;
        height: 26px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Event chips on calendar */
      .event-chip {
        font-size: 0.7rem;
        font-weight: 500;
        border-radius: 4px;
        padding: 2px 6px;
        margin-bottom: 2px;
        color: white;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        cursor: pointer;
        transition:
          opacity 0.15s,
          transform 0.15s;
        display: block;
      }

      .event-chip:hover {
        opacity: 0.85;
        transform: translateX(1px);
      }

      /* ===========================
       MODALS
    =========================== */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(10, 20, 50, 0.45);
        backdrop-filter: blur(4px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.25s ease;
        padding: 20px;
      }

      .modal-overlay.open {
        opacity: 1;
        pointer-events: all;
      }

      .modal {
        background: var(--white);
        border-radius: var(--radius);
        box-shadow: var(--shadow-lg);
        width: 100%;
        max-width: 460px;
        transform: translateY(20px) scale(0.97);
        transition: transform 0.25s ease;
        overflow: hidden;
      }

      .modal-overlay.open .modal {
        transform: translateY(0) scale(1);
      }

      .modal-header {
        background: linear-gradient(135deg, var(--ieee-dark), var(--ieee-blue));
        padding: 22px 28px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .modal-title {
        font-family: "Syne", sans-serif;
        font-weight: 700;
        font-size: 1.05rem;
        color: white;
      }

      .modal-close {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.15s;
        font-size: 1.1rem;
        line-height: 1;
      }

      .modal-close:hover {
        background: rgba(255, 255, 255, 0.35);
      }

      .modal-body {
        padding: 28px;
      }

      /* Form elements */
      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        font-size: 0.82rem;
        font-weight: 600;
        letter-spacing: 0.3px;
        color: var(--muted);
        text-transform: uppercase;
        margin-bottom: 7px;
      }

      input[type="text"],
      input[type="email"],
      input[type="date"],
      select {
        width: 100%;
        padding: 11px 14px;
        border: 1.5px solid var(--border);
        border-radius: var(--radius-sm);
        font-family: "DM Sans", sans-serif;
        font-size: 0.93rem;
        color: var(--text);
        background: var(--white);
        transition:
          border-color 0.18s,
          box-shadow 0.18s;
        outline: none;
        appearance: none;
      }

      input:focus,
      select:focus {
        border-color: var(--ieee-blue);
        box-shadow: 0 0 0 3px rgba(0, 102, 153, 0.12);
      }

      select {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%237a849a' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 14px center;
        padding-right: 36px;
        cursor: pointer;
      }

      .error-msg {
        background: #fff0f0;
        border: 1px solid #fecaca;
        color: #c0392b;
        padding: 10px 14px;
        border-radius: var(--radius-sm);
        font-size: 0.85rem;
        margin-top: 10px;
        display: none;
      }

      .error-msg.show {
        display: block;
      }

      .success-msg {
        background: #f0fdf4;
        border: 1px solid #bbf7d0;
        color: #15803d;
        padding: 10px 14px;
        border-radius: var(--radius-sm);
        font-size: 0.85rem;
        margin-top: 10px;
        display: none;
      }

      .success-msg.show {
        display: block;
      }

      .btn-primary {
        width: 100%;
        padding: 13px;
        background: linear-gradient(135deg, var(--ieee-dark), var(--ieee-blue));
        color: white;
        border: none;
        border-radius: var(--radius-sm);
        font-family: "Syne", sans-serif;
        font-weight: 700;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s;
        letter-spacing: 0.3px;
      }

      .btn-primary:hover {
        opacity: 0.92;
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(0, 51, 102, 0.3);
      }

      .btn-secondary {
        width: 100%;
        padding: 11px;
        background: transparent;
        color: var(--ieee-blue);
        border: 1.5px solid var(--ieee-blue);
        border-radius: var(--radius-sm);
        font-family: "Syne", sans-serif;
        font-weight: 600;
        font-size: 0.88rem;
        cursor: pointer;
        transition: all 0.18s;
        margin-top: 10px;
      }

      .btn-secondary:hover {
        background: var(--ieee-blue);
        color: white;
      }

      /* Chapter color preview */
      .chapter-preview {
        display: flex;
        gap: 8px;
        margin-top: 8px;
        flex-wrap: wrap;
      }

      .chapter-badge {
        font-size: 0.73rem;
        font-weight: 600;
        color: white;
        border-radius: 4px;
        padding: 3px 10px;
      }

      /* Tooltip for event details */
      .event-tooltip {
        position: fixed;
        background: var(--text);
        color: white;
        padding: 8px 12px;
        border-radius: var(--radius-sm);
        font-size: 0.8rem;
        pointer-events: none;
        z-index: 500;
        opacity: 0;
        transition: opacity 0.15s;
        max-width: 200px;
      }

      .event-tooltip.visible {
        opacity: 1;
      }

      /* ===========================
       RESPONSIVE
    =========================== */
      @media (max-width: 640px) {
        header {
          padding: 0 16px;
        }
        .header-title {
          font-size: 0.95rem;
        }
        .header-subtitle {
          display: none;
        }
        main {
          padding: 16px 10px 40px;
        }
        .day-cell {
          min-height: 64px;
          padding: 4px 3px;
        }
        .day-num {
          font-size: 0.75rem;
          width: 22px;
          height: 22px;
        }
        .event-chip {
          font-size: 0.62rem;
          padding: 1px 4px;
        }
        .calendar-month-label {
          font-size: 1rem;
        }
        .legend {
          gap: 6px;
        }
        .legend-item {
          font-size: 0.73rem;
          padding: 4px 10px 4px 8px;
        }
      }
    </style>
  </head>
  <body>
    <!-- =====================
     HEADER
===================== -->
    <header>
      <div class="header-brand">
        <div class="header-logo">IEEE<br />EPI</div>
        <div>
          <div class="header-title">IEEE EPI SB</div>
          <div class="header-subtitle">Event Management Platform</div>
        </div>
      </div>
      <button class="add-event-btn" id="openAuthModal">
        <svg
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2.5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 4v16m8-8H4"
          />
        </svg>
        Add Event
      </button>
    </header>

    <!-- =====================
     MAIN CONTENT
===================== -->
    <main>
      <!-- Chapter legend -->
      <div class="legend">
        <div class="legend-item">
          <span class="legend-dot" style="background: var(--sb)"></span>SB
        </div>
        <div class="legend-item">
          <span class="legend-dot" style="background: var(--ias)"></span>IAS
        </div>
        <div class="legend-item">
          <span class="legend-dot" style="background: var(--wie)"></span>WIE
        </div>
        <div class="legend-item">
          <span class="legend-dot" style="background: var(--ras)"></span>RAS
        </div>
        <div class="legend-item">
          <span class="legend-dot" style="background: var(--cis)"></span>CIS
        </div>
        <div class="legend-item">
          <span class="legend-dot" style="background: var(--cs)"></span>CS
        </div>
      </div>

      <!-- Calendar card -->
      <div class="calendar-card">
        <!-- Navigation -->
        <div class="calendar-nav">
          <button class="calendar-nav-btn" id="prevMonth">
            <svg
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2.5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M15 19l-7-7 7-7"
              />
            </svg>
          </button>
          <span class="calendar-month-label" id="monthLabel"></span>
          <button class="calendar-nav-btn" id="nextMonth">
            <svg
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2.5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 5l7 7-7 7"
              />
            </svg>
          </button>
        </div>

        <!-- Grid (day headers + cells) -->
        <div class="calendar-grid" id="calendarGrid"></div>
      </div>
    </main>

    <!-- =====================
     EVENT TOOLTIP
===================== -->
    <div class="event-tooltip" id="tooltip"></div>

    <!-- =====================
     MODAL 1: Email Auth
===================== -->
    <div class="modal-overlay" id="authModal">
      <div class="modal">
        <div class="modal-header">
          <span class="modal-title">üîê Access Verification</span>
          <button class="modal-close" id="closeAuthModal">‚úï</button>
        </div>
        <div class="modal-body">
          <p
            style="font-size: 0.88rem; color: var(--muted); margin-bottom: 20px"
          >
            Enter your authorized IEEE email address to access the event
            creation form.
          </p>
          <div class="form-group">
            <label for="authEmail">IEEE Email Address</label>
            <input
              type="email"
              id="authEmail"
              placeholder="yourname@ieee.org"
            />
          </div>
          <div class="error-msg" id="authError">
            ‚ùå You do not have permission to add events.
          </div>
          <button class="btn-primary" id="verifyEmail">Verify Access</button>
        </div>
      </div>
    </div>

    <!-- =====================
     MODAL 2: Create Event
===================== -->
    <div class="modal-overlay" id="eventModal">
      <div class="modal">
        <div class="modal-header">
          <span class="modal-title">üìÖ Create New Event</span>
          <button class="modal-close" id="closeEventModal">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="eventTitle">Event Title</label>
            <input
              type="text"
              id="eventTitle"
              placeholder="e.g. General Meeting, Workshop..."
            />
          </div>
          <div class="form-group">
            <label for="eventDate">Event Date</label>
            <input type="date" id="eventDate" />
          </div>
          <div class="form-group">
            <label for="eventChapter">Chapter</label>
            <select id="eventChapter">
              <option value="SB">SB ‚Äì Student Branch</option>
              <option value="RAS">RAS ‚Äì Robotics &amp; Automation</option>
              <option value="WIE">WIE ‚Äì Women in Engineering</option>
              <option value="IAS">IAS ‚Äì Industry Applications</option>
              <option value="CIS">CIS ‚Äì Computational Intelligence</option>
              <option value="CS">CS ‚Äì Computer Society</option>
            </select>
            <!-- Live chapter color preview -->
            <div class="chapter-preview" id="chapterPreview"></div>
          </div>
          <div class="error-msg" id="eventError">
            Please fill in all fields.
          </div>
          <div class="success-msg" id="eventSuccess">
            ‚úÖ Event added successfully!
          </div>
          <button class="btn-primary" id="saveEvent">Add to Calendar</button>
          <button class="btn-secondary" id="backToAuth">‚Üê Back</button>
        </div>
      </div>
    </div>

    <!-- =====================
     JAVASCRIPT
===================== -->
    <script>
      // =========================================================
      //  CONFIGURATION
      // =========================================================

      /** Allowed email addresses (simulated auth ‚Äì no backend) */
      const ALLOWED_EMAILS = ["karim.thabet@ieee.org"];

      /** Chapter ‚Üí color mapping */
      const CHAPTER_COLORS = {
        SB: "var(--sb)",
        IAS: "var(--ias)",
        WIE: "var(--wie)",
        RAS: "var(--ras)",
        CIS: "var(--cis)",
        CS: "var(--cs)",
      };

      /** Resolved hex-like values for inline styles (CSS vars don't work in some inline contexts) */
      const CHAPTER_HEX = {
        SB: "#1a73e8",
        IAS: "#1ea86e",
        WIE: "#8b5cf6",
        RAS: "#e8372a",
        CIS: "#0fc3c3",
        CS: "#f97316",
      };

      // =========================================================
      //  STATE
      // =========================================================

      /** Load events from localStorage or use sample events */
      let events = JSON.parse(
        localStorage.getItem("ieee_epi_events") || "null",
      ) || [
        { title: "SB General Meeting", date: formatToday(0), chapter: "SB" },
        { title: "RAS Workshop", date: formatToday(3), chapter: "RAS" },
        { title: "WIE Networking Event", date: formatToday(7), chapter: "WIE" },
        { title: "CIS Tech Talk", date: formatToday(-4), chapter: "CIS" },
        { title: "CS Hackathon", date: formatToday(10), chapter: "CS" },
        {
          title: "IAS Industry Seminar",
          date: formatToday(14),
          chapter: "IAS",
        },
      ];

      let currentYear, currentMonth; // currently displayed month

      // =========================================================
      //  HELPERS
      // =========================================================

      /** Return a date string YYYY-MM-DD offset by `delta` days from today */
      function formatToday(delta) {
        const d = new Date();
        d.setDate(d.getDate() + delta);
        return d.toISOString().split("T")[0];
      }

      /** Persist events to localStorage */
      function saveEvents() {
        localStorage.setItem("ieee_epi_events", JSON.stringify(events));
      }

      /** Today's date as YYYY-MM-DD */
      const TODAY = formatToday(0);

      // =========================================================
      //  CALENDAR RENDERING
      // =========================================================

      const MONTH_NAMES = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
      ];
      const DAY_NAMES = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

      function initCalendar() {
        const now = new Date();
        currentYear = now.getFullYear();
        currentMonth = now.getMonth(); // 0-based
        renderCalendar();
      }

      function renderCalendar() {
        document.getElementById("monthLabel").textContent =
          `${MONTH_NAMES[currentMonth]} ${currentYear}`;

        const grid = document.getElementById("calendarGrid");
        grid.innerHTML = "";

        // Day-of-week headers
        DAY_NAMES.forEach((d) => {
          const el = document.createElement("div");
          el.className = "day-header";
          el.textContent = d;
          grid.appendChild(el);
        });

        const firstDay = new Date(currentYear, currentMonth, 1).getDay(); // 0=Sun
        const daysInMonth = new Date(
          currentYear,
          currentMonth + 1,
          0,
        ).getDate();
        const daysInPrev = new Date(currentYear, currentMonth, 0).getDate();

        // Build a flat array of 42 cells (6 weeks √ó 7)
        const cells = [];

        // Previous month filler
        for (let i = firstDay - 1; i >= 0; i--) {
          cells.push({ day: daysInPrev - i, type: "prev" });
        }

        // Current month
        for (let d = 1; d <= daysInMonth; d++) {
          cells.push({ day: d, type: "current" });
        }

        // Next month filler
        let next = 1;
        while (cells.length < 42) {
          cells.push({ day: next++, type: "next" });
        }

        // Render cells
        cells.forEach(({ day, type }) => {
          const cell = document.createElement("div");
          cell.className =
            "day-cell" + (type !== "current" ? " other-month" : "");

          // Determine full date string for this cell
          let cellDate;
          if (type === "current") {
            cellDate = `${currentYear}-${String(currentMonth + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
          } else if (type === "prev") {
            const m = currentMonth === 0 ? 12 : currentMonth;
            const y = currentMonth === 0 ? currentYear - 1 : currentYear;
            cellDate = `${y}-${String(m).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
          } else {
            const m = currentMonth === 11 ? 1 : currentMonth + 2;
            const y = currentMonth === 11 ? currentYear + 1 : currentYear;
            cellDate = `${y}-${String(m).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
          }

          // Highlight today
          if (cellDate === TODAY) cell.classList.add("today");

          // Day number
          const numEl = document.createElement("div");
          numEl.className = "day-num";
          numEl.textContent = day;
          cell.appendChild(numEl);

          // Events for this cell
          const dayEvents = events.filter((e) => e.date === cellDate);
          dayEvents.forEach((ev) => {
            const chip = document.createElement("div");
            chip.className = "event-chip";
            chip.style.background = CHAPTER_HEX[ev.chapter] || "#888";
            chip.textContent = ev.title;
            chip.setAttribute("data-title", ev.title);
            chip.setAttribute("data-date", ev.date);
            chip.setAttribute("data-chapter", ev.chapter);

            // Tooltip on hover
            chip.addEventListener("mouseenter", showTooltip);
            chip.addEventListener("mouseleave", hideTooltip);
            chip.addEventListener("mousemove", moveTooltip);

            cell.appendChild(chip);
          });

          grid.appendChild(cell);
        });
      }

      // =========================================================
      //  TOOLTIP
      // =========================================================

      const tooltip = document.getElementById("tooltip");

      function showTooltip(e) {
        const { title, date, chapter } = e.target.dataset;
        tooltip.innerHTML = `<strong>${title}</strong><br>${date}<br>Chapter: ${chapter}`;
        tooltip.classList.add("visible");
      }

      function hideTooltip() {
        tooltip.classList.remove("visible");
      }

      function moveTooltip(e) {
        tooltip.style.left = e.clientX + 12 + "px";
        tooltip.style.top = e.clientY - 40 + "px";
      }

      // =========================================================
      //  CALENDAR NAVIGATION
      // =========================================================

      document.getElementById("prevMonth").addEventListener("click", () => {
        if (--currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        }
        renderCalendar();
      });

      document.getElementById("nextMonth").addEventListener("click", () => {
        if (++currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
        renderCalendar();
      });

      // =========================================================
      //  MODAL HELPERS
      // =========================================================

      function openModal(id) {
        document.getElementById(id).classList.add("open");
      }
      function closeModal(id) {
        document.getElementById(id).classList.remove("open");
      }

      // Close on overlay click
      document.querySelectorAll(".modal-overlay").forEach((overlay) => {
        overlay.addEventListener("click", (e) => {
          if (e.target === overlay) closeModal(overlay.id);
        });
      });

      // =========================================================
      //  AUTH MODAL
      // =========================================================

      document.getElementById("openAuthModal").addEventListener("click", () => {
        document.getElementById("authEmail").value = "";
        document.getElementById("authError").classList.remove("show");
        openModal("authModal");
      });

      document
        .getElementById("closeAuthModal")
        .addEventListener("click", () => {
          closeModal("authModal");
        });

      document.getElementById("verifyEmail").addEventListener("click", () => {
        const email = document
          .getElementById("authEmail")
          .value.trim()
          .toLowerCase();
        const error = document.getElementById("authError");

        if (ALLOWED_EMAILS.includes(email)) {
          // Authorized ‚Üí close auth, open event form
          error.classList.remove("show");
          closeModal("authModal");
          openEventModal();
        } else {
          // Unauthorized
          error.classList.add("show");
        }
      });

      // Allow pressing Enter in email field
      document.getElementById("authEmail").addEventListener("keydown", (e) => {
        if (e.key === "Enter") document.getElementById("verifyEmail").click();
      });

      // =========================================================
      //  EVENT CREATION MODAL
      // =========================================================

      function openEventModal() {
        // Pre-fill today's date
        document.getElementById("eventDate").value = TODAY;
        document.getElementById("eventTitle").value = "";
        document.getElementById("eventChapter").value = "SB";
        document.getElementById("eventError").classList.remove("show");
        document.getElementById("eventSuccess").classList.remove("show");
        updateChapterPreview();
        openModal("eventModal");
      }

      /** Show a colored badge preview for the selected chapter */
      function updateChapterPreview() {
        const chapter = document.getElementById("eventChapter").value;
        const preview = document.getElementById("chapterPreview");
        const color = CHAPTER_HEX[chapter] || "#888";
        preview.innerHTML = `
      <span class="chapter-badge" style="background:${color}">${chapter}</span>
      <small style="font-size:0.75rem;color:var(--muted);align-self:center;">
        Events will appear in this color
      </small>`;
      }

      document
        .getElementById("eventChapter")
        .addEventListener("change", updateChapterPreview);

      document
        .getElementById("closeEventModal")
        .addEventListener("click", () => {
          closeModal("eventModal");
        });

      document.getElementById("backToAuth").addEventListener("click", () => {
        closeModal("eventModal");
        openModal("authModal");
      });

      /** Save the new event */
      document.getElementById("saveEvent").addEventListener("click", () => {
        const title = document.getElementById("eventTitle").value.trim();
        const date = document.getElementById("eventDate").value;
        const chapter = document.getElementById("eventChapter").value;
        const errEl = document.getElementById("eventError");
        const succEl = document.getElementById("eventSuccess");

        // Validation
        if (!title || !date || !chapter) {
          errEl.classList.add("show");
          succEl.classList.remove("show");
          return;
        }

        errEl.classList.remove("show");

        // Add event to state and persist
        events.push({ title, date, chapter });
        saveEvents();

        // Navigate calendar to the event's month/year if needed
        const [y, m] = date.split("-").map(Number);
        currentYear = y;
        currentMonth = m - 1;
        renderCalendar();

        // Show success, then close
        succEl.classList.add("show");
        setTimeout(() => {
          succEl.classList.remove("show");
          closeModal("eventModal");
        }, 1500);
      });

      // =========================================================
      //  INIT
      // =========================================================
      initCalendar();
    </script>
  </body>
</html>
